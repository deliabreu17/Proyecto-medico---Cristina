<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema M√©dico - Dra. Cristina Garc√≠a</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="auditoria.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@500;600;700&display=swap"
        rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- ==================== LOGIN ==================== -->
    <div id="login-page" class="login-container">
        <div class="login-card-split">
            <!-- Branding Side (Left) -->
            <div class="login-brand-side">
                <div class="brand-overlay"></div>
                <div class="brand-content">
                    <div class="login-logo-large">
                        <svg viewBox="0 0 200 200"
                            style="width: 100%; height: 100%; filter: drop-shadow(0 8px 16px rgba(0,0,0,0.2));">
                            <!-- 1. Parte Izquierda del Coraz√≥n (Cyan/Turquesa) -->
                            <path d="M100 160 
                                     C 60 140, 40 100, 45 70 
                                     C 50 40, 80 40, 95 65
                                     C 85 55, 65 55, 60 75
                                     C 55 95, 75 125, 100 145" fill="#5DADE2" stroke="#48C9B0" stroke-width="1" />

                            <!-- 2. Parte Central del Coraz√≥n (Rosa/Rojo) -->
                            <path d="M100 145
                                     C 125 125, 140 95, 135 75
                                     C 130 55, 100 55, 90 75" fill="#EC7063" />

                            <!-- 3. Figura Humana Abstracta (Centro) -->
                            <circle cx="95" cy="85" r="8" fill="#AF7AC5" />
                            <path d="M80 100 Q 95 110 110 100 L 105 115 Q 95 120 85 115 Z" fill="#6C3483" />

                            <!-- 4. Estetoscopio (Azul Oscuro y Verde) -->
                            <path d="M135 60
                                     C 145 50, 160 50, 165 65
                                     C 170 85, 150 120, 100 160
                                     C 90 168, 80 150, 90 140" fill="none" stroke="#1F618D" stroke-width="8"
                                stroke-linecap="round" />

                            <path d="M135 60 L 135 40" stroke="#5D6D7E" stroke-width="6" />
                            <path d="M165 65 L 165 40" stroke="#5D6D7E" stroke-width="6" />
                            <path d="M135 40 Q 150 20 165 40" fill="none" stroke="#5D6D7E" stroke-width="4" />
                            <circle cx="132" cy="40" r="4" fill="#1F618D" />
                            <circle cx="168" cy="40" r="4" fill="#1F618D" />
                            <circle cx="110" cy="155" r="12" fill="#58D68D" stroke="#1F618D" stroke-width="2" />
                            <circle cx="110" cy="155" r="5" fill="#1F618D" />
                        </svg>
                    </div>
                    <h1>Dra. Cristina Garc√≠a Dom√≠nguez</h1>
                    <p>Pediatra Cardi√≥logo</p>
                </div>
            </div>

            <!-- Form Side (Right) -->
            <div class="login-form-side">
                <div class="form-wrapper">
                    <div class="form-header">
                        <h2>Bienvenido</h2>
                        <p>Sistema de Gesti√≥n M√©dica</p>
                    </div>

                    <form id="login-form">
                        <div class="form-group floating-group">
                            <label>Usuario</label>
                            <input type="text" id="login-user" class="form-control" placeholder="Ej: admin" required>
                        </div>
                        <div class="form-group floating-group">
                            <label>Contrase√±a</label>
                            <input type="password" id="login-pass" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        </div>
                        <div id="login-error" class="error-msg" style="display:none;"></div>
                        <button type="submit" class="btn-primary btn-full btn-lg">Acceder al Sistema</button>
                    </form>
                </div>
                <div class="login-footer">
                    <p>&copy; 2025 Dra. Garc√≠a</p>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- ==================== APP ==================== -->
    <div id="app-container" class="app-container" style="display:none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon" style="width: 50px; height: 50px; background: none; font-size: 0;">
                    <svg viewBox="0 0 200 200" style="width: 100%; height: 100%;">
                        <!-- 1. Parte Izquierda (Cyan) -->
                        <path
                            d="M100 160 C 60 140, 40 100, 45 70 C 50 40, 80 40, 95 65 C 85 55, 65 55, 60 75 C 55 95, 75 125, 100 145"
                            fill="#5DADE2" />
                        <!-- 2. Parte Central (Rosa) -->
                        <path d="M100 145 C 125 125, 140 95, 135 75 C 130 55, 100 55, 90 75" fill="#EC7063" />
                        <!-- 3. Figura (Morado) -->
                        <circle cx="95" cy="85" r="8" fill="#AF7AC5" />
                        <path d="M80 100 Q 95 110 110 100 L 105 115 Q 95 120 85 115 Z" fill="#6C3483" />
                        <!-- 4. Estetoscopio (Azul) -->
                        <path d="M135 60 C 145 50, 160 50, 165 65 C 170 85, 150 120, 100 160" fill="none"
                            stroke="#1F618D" stroke-width="8" stroke-linecap="round" />
                        <!-- Campana Verde -->
                        <circle cx="110" cy="155" r="10" fill="#58D68D" />
                    </svg>
                </div>
                <div class="logo-text">
                    <h1 style="font-size: 14px; margin-bottom: 2px; line-height: 1.2;">Dra. Cristina Garc√≠a Dom√≠nguez
                    </h1>
                    <p style="font-size: 10px; opacity: 0.8; color: #82e0aa;">Pediatra Cardi√≥logo</p>
                </div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üè†</span>
                    Inicio
                </a>
                <a href="#" class="nav-item" data-view="citas">
                    <span class="nav-icon">üìÖ</span>
                    Agenda
                </a>
                <a href="#" class="nav-item" data-view="pacientes">
                    <span class="nav-icon">üë•</span>
                    Pacientes
                </a>
                <a href="#" class="nav-item" data-view="estadisticas">
                    <span class="nav-icon">üìä</span>
                    Estad√≠sticas
                </a>
                <a href="#" class="nav-item" data-view="auditoria" id="nav-auditoria" style="display: none;">
                    <span class="nav-icon">üõ°Ô∏è</span>
                    Auditor√≠a
                </a>
                <a href="#" class="nav-item" data-view="finanzas" id="nav-finanzas" style="display: none;">
                    <span class="nav-icon">üí∞</span>
                    Finanzas
                </a>
            </nav>

            <div class="sidebar-user">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">A</div>
                    <div>
                        <p class="user-name" id="user-name">Usuario</p>
                        <p class="user-role" id="user-role">Rol</p>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <button id="btn-notifications" class="btn-theme" style="position: relative;"
                        title="Citas recientes">
                        üîî
                        <span id="badge-notifications"
                            style="position: absolute; top: 0; right: 0; width: 10px; height: 10px; background: #e74c3c; border-radius: 50%; border: 2px solid white; display: none;"></span>
                    </button>
                    <button id="btn-dark-mode" class="btn-theme" title="Cambiar tema">üåô</button>
                    <button id="btn-logout" class="btn-logout">Salir</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <section id="view-dashboard" class="view active">
                <header class="page-header">
                    <div>
                        <h2 class="page-title">¬°Buen d√≠a! üëã</h2>
                        <p class="page-subtitle" id="fecha-hoy"></p>
                    </div>
                    <div class="sync-controls">
                        <span class="sync-status" id="sync-status">
                            <span class="sync-indicator"></span>
                            <span id="ultima-sync">Sincronizando...</span>
                        </span>
                        <button id="btn-refresh" class="btn-secondary">üîÑ Actualizar</button>
                    </div>
                </header>

                <!-- B√∫squeda Global -->
                <div class="global-search-container">
                    <input type="text" id="global-search" class="global-search"
                        placeholder="üîç Buscar paciente por nombre o tel√©fono...">
                    <div id="global-search-results" class="search-results-dropdown"></div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card stat-teal">
                        <div class="stat-content">
                            <p class="stat-label">Citas Hoy</p>
                            <p class="stat-value" id="stat-citas-hoy">-</p>
                        </div>
                        <div class="stat-icon">üìÖ</div>
                    </div>
                    <div class="stat-card stat-coral" id="card-pacientes">
                        <div class="stat-content">
                            <p class="stat-label">Total Pacientes</p>
                            <p class="stat-value" id="stat-pacientes">-</p>
                        </div>
                        <div class="stat-icon">üë•</div>
                    </div>
                    <div class="stat-card stat-purple" id="card-citas">
                        <div class="stat-content">
                            <p class="stat-label">Total Citas</p>
                            <p class="stat-value" id="stat-total">-</p>
                        </div>
                        <div class="stat-icon">üìã</div>
                    </div>
                    <div class="stat-card stat-green" id="card-nuevos">
                        <div class="stat-content">
                            <p class="stat-label">Pacientes Nuevos</p>
                            <p class="stat-value" id="stat-nuevos">-</p>
                        </div>
                        <div class="stat-icon">üÜï</div>
                    </div>
                    <div class="stat-card stat-blue" id="card-recurrentes">
                        <div class="stat-content">
                            <p class="stat-label">Pacientes Recurrentes</p>
                            <p class="stat-value" id="stat-recurrentes">-</p>
                        </div>
                        <div class="stat-icon">üîÑ</div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3>üìã Citas de Hoy</h3>
                        <a href="#" class="link-btn" data-view="citas">Ver todas ‚Üí</a>
                    </div>
                    <div id="citas-hoy-lista" class="citas-lista">
                        <p class="empty-state">Cargando citas...</p>
                    </div>
                </div>
            </section>

            <!-- Agenda View -->
            <section id="view-citas" class="view">
                <header class="page-header">
                    <div>
                        <h2 class="page-title">üìÖ Agenda de Citas</h2>
                        <p class="page-subtitle">Gestiona las citas del consultorio</p>
                    </div>
                    <button id="btn-print-agenda" class="btn-secondary">üñ®Ô∏è Imprimir</button>
                </header>

                <div class="date-nav">
                    <button id="btn-prev-day" class="btn-secondary">‚Üê Anterior</button>
                    <div class="date-display">
                        <h3 id="fecha-seleccionada"></h3>
                        <p id="citas-count"></p>
                        <input type="date" id="fecha-picker" title="Seleccionar fecha">
                    </div>

                    <select id="agenda-estado-filter" class="form-input"
                        style="width: auto; margin: 0 10px; padding: 8px; cursor: pointer;">
                        <option value="dia">üìÖ Citas del D√≠a</option>
                        <option value="todas">üìã Historial Completo</option>
                        <option value="confirmada">‚úÖ Solo Confirmadas</option>
                        <option value="cancelada">‚ùå Solo Canceladas</option>
                        <option value="reagendada">üîÑ Solo Reagendadas</option>
                        <option value="completada">üèÅ Solo Completadas</option>
                    </select>

                    <button id="btn-next-day" class="btn-secondary">Siguiente ‚Üí</button>
                </div>

                <div id="citas-agenda-lista" class="citas-lista">
                    <p class="empty-state">Cargando citas...</p>
                </div>
            </section>

            <!-- Pacientes View -->
            <section id="view-pacientes" class="view">
                <header class="page-header">
                    <div>
                        <h2 class="page-title">üë• Pacientes</h2>
                        <p class="page-subtitle" id="pacientes-count">Cargando...</p>
                    </div>
                </header>

                <div class="search-box">
                    <input type="text" id="buscar-paciente" placeholder="üîç Buscar paciente por nombre o tel√©fono...">
                </div>

                <div id="pacientes-lista" class="pacientes-lista">
                    <p class="empty-state">Cargando pacientes...</p>
                </div>
            </section>

            <!-- Estad√≠sticas View -->
            <section id="view-estadisticas" class="view">
                <header class="page-header">
                    <div>
                        <h2 class="page-title">üìä Estad√≠sticas</h2>
                        <p class="page-subtitle">An√°lisis de datos del consultorio</p>
                    </div>
                    <button id="btn-refresh-stats" class="btn-secondary">üîÑ Actualizar</button>
                </header>

                <!-- Resumen General -->
                <div class="stats-grid stats-small">
                    <div class="stat-card stat-teal">
                        <div class="stat-content">
                            <p class="stat-label">Total Citas</p>
                            <p class="stat-value" id="stats-total-citas">-</p>
                        </div>
                    </div>
                    <div class="stat-card stat-coral">
                        <div class="stat-content">
                            <p class="stat-label">Total Pacientes</p>
                            <p class="stat-value" id="stats-total-pacientes">-</p>
                        </div>
                    </div>
                    <div class="stat-card stat-green">
                        <div class="stat-content">
                            <p class="stat-label">Pacientes Nuevos</p>
                            <p class="stat-value" id="stats-nuevos">-</p>
                        </div>
                    </div>
                    <div class="stat-card stat-purple">
                        <div class="stat-content">
                            <p class="stat-label">Pacientes Recurrentes</p>
                            <p class="stat-value" id="stats-recurrentes">-</p>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Especialidad m√°s solicitada -->
                    <div class="chart-card">
                        <h3>ü©∫ Especialidades Solicitadas</h3>
                        <div id="chart-especialidades" class="chart-bars"></div>
                    </div>

                    <!-- Tipo de Seguro -->
                    <div class="chart-card">
                        <h3>üí≥ Tipo de Consulta</h3>
                        <div id="chart-seguro" class="chart-bars"></div>
                    </div>
                    <!-- Distribuci√≥n ARS -->
                    <div class="chart-card chart-full">
                        <h3>üè• Distribuci√≥n de ARS (Aseguradoras)</h3>
                        <div id="chart-ars" class="chart-bars"></div>
                    </div>

                    <!-- Motivos principales -->
                    <div class="chart-card chart-full">
                        <h3>üìã Motivos Principales de Consulta</h3>
                        <div id="chart-motivos" class="chart-bars"></div>
                    </div>
                </div>

                <!-- Secci√≥n Financiera -->
                <h2 class="section-title" style="margin-top: 30px; font-size: 20px; color: var(--text-dark);">üí∞
                    Estad√≠sticas Financieras</h2>

                <div class="stats-grid stats-small" style="margin-top: 15px;">
                    <div class="stat-card stat-green">
                        <div class="stat-content">
                            <p class="stat-label">Ingresos Totales</p>
                            <p class="stat-value" id="stats-ingresos-totales">RD$ -</p>
                        </div>
                    </div>
                    <div class="stat-card stat-blue">
                        <div class="stat-content">
                            <p class="stat-label">Promedio por Cita</p>
                            <p class="stat-value" id="stats-promedio-cita">RD$ -</p>
                        </div>
                    </div>
                    <div class="stat-card stat-coral">
                        <div class="stat-content">
                            <p class="stat-label">Ingresos Seguro</p>
                            <p class="stat-value" id="stats-ingresos-seguro">RD$ -</p>
                        </div>
                    </div>
                    <div class="stat-card stat-purple">
                        <div class="stat-content">
                            <p class="stat-label">Ingresos Privado</p>
                            <p class="stat-value" id="stats-ingresos-privado">RD$ -</p>
                        </div>
                    </div>
                </div>

                <div class="charts-grid" style="margin-top: 20px;">
                    <!-- Ingresos por Especialidad -->
                    <div class="chart-card">
                        <h3>ü©∫ Ingresos por Especialidad</h3>
                        <div id="chart-ingresos-especialidad" class="chart-bars"></div>
                    </div>

                    <!-- Ingresos por Tipo de Seguro -->
                    <div class="chart-card">
                        <h3>üí≥ Ingresos por Tipo de Consulta</h3>
                        <div id="chart-ingresos-seguro" class="chart-bars"></div>
                    </div>

                    <!-- Gr√°fico de Ingresos por Mes -->
                    <div class="chart-card chart-full">
                        <h3>üìÖ Ingresos Mensuales</h3>
                        <div id="chart-ingresos-mensuales" class="chart-monthly"></div>
                    </div>
                </div>

                <!-- Filtros Activos -->
                <div id="filtros-activos" class="filtros-activos" style="display: none;">
                    <span class="filtros-label">üîç Filtros activos:</span>
                    <div id="filtros-badges" class="filtros-badges"></div>
                    <button id="btn-limpiar-filtros" class="btn-limpiar">‚úï Limpiar filtros</button>
                </div>
            </section>

            <!-- Audit View -->
            <section id="view-auditoria" class="view">
                <header class="page-header">
                    <div>
                        <h2 class="page-title">üõ°Ô∏è Auditor√≠a de Acciones</h2>
                        <p class="page-subtitle">Rastro de actividad (Secretaria y Admin)</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="cargarAuditoria()">üîÑ Actualizar</button>
                    </div>
                </header>
                <div class="card" style="padding: 0;">
                    <div class="table-container" style="max-height: 65vh; overflow-y: auto;">
                        <table class="data-table" id="tabla-auditoria" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Usuario</th>
                                    <th>Rol</th>
                                    <th>Acci√≥n</th>
                                    <th>Detalle</th>
                                </tr>
                            </thead>
                            <tbody id="lista-auditoria">
                                <!-- JS Injected -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Finanzas View (Admin Only) -->
            <section id="view-finanzas" class="view">
                <header class="page-header">
                    <div>
                        <h2 class="page-title">üí∞ Control Financiero</h2>
                        <p class="page-subtitle">Ingresos y gastos del consultorio</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="cargarFinanzas()">üîÑ Actualizar</button>
                        <button class="btn-secondary" onclick="exportarFinanzasCSV()">üì• Exportar CSV</button>
                    </div>
                </header>

                <!-- Resumen Cards -->
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card" style="border-left: 4px solid #27ae60;">
                        <div class="stat-icon" style="background: rgba(39, 174, 96, 0.2);">üíµ</div>
                        <div class="stat-info">
                            <p class="stat-label">Total Ingresos</p>
                            <p class="stat-value" id="fin-total-ingresos">RD$ 0</p>
                        </div>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #e74c3c;">
                        <div class="stat-icon" style="background: rgba(231, 76, 60, 0.2);">üìâ</div>
                        <div class="stat-info">
                            <p class="stat-label">Total Gastos</p>
                            <p class="stat-value" id="fin-total-gastos">RD$ 0</p>
                        </div>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #3498db;">
                        <div class="stat-icon" style="background: rgba(52, 152, 219, 0.2);">üìä</div>
                        <div class="stat-info">
                            <p class="stat-label">Balance Neto</p>
                            <p class="stat-value" id="fin-balance">RD$ 0</p>
                        </div>
                    </div>
                </div>

                <!-- Forms Section (Tabs) -->
                <div class="fin-container" style="max-width: 800px; margin: 0 auto 30px auto;">

                    <!-- Tabs Navigation -->
                    <div class="fin-tabs"
                        style="display: flex; gap: 20px; margin-bottom: 20px; justify-content: center;">
                        <button class="fin-tab active" id="tab-ingreso" onclick="switchFinanzaTab('ingreso')"
                            style="padding: 12px 30px; border: none; border-radius: 30px; background: #27ae60; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3); transition: all 0.3s ease;">
                            üíµ Registrar Ingreso
                        </button>
                        <button class="fin-tab" id="tab-gasto" onclick="switchFinanzaTab('gasto')"
                            style="padding: 12px 30px; border: none; border-radius: 30px; background: #f0f2f5; color: #7f8c8d; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                            üìâ Registrar Gasto
                        </button>
                    </div>

                    <!-- Form Ingreso -->
                    <div id="form-container-ingreso" class="card fin-form-card"
                        style="border-top: 5px solid #27ae60; animation: fadeIn 0.3s ease;">
                        <h3 style="margin-bottom: 20px; color: #27ae60; text-align: center;">Nueva Entrada de Dinero
                        </h3>
                        <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label style="font-weight: 500; color: #555;">Monto (RD$)</label>
                                <input type="number" id="fin-ingreso-monto" class="form-input" placeholder="0.00"
                                    min="0" step="0.01" style="font-size: 1.2em; padding: 12px; border-radius: 8px;">
                            </div>
                            <div class="form-group">
                                <label style="font-weight: 500; color: #555;">Fecha</label>
                                <input type="date" id="fin-ingreso-fecha" class="form-input"
                                    style="padding: 12px; border-radius: 8px;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label style="font-weight: 500; color: #555;">Concepto / Raz√≥n</label>
                            <input type="text" id="fin-ingreso-concepto" class="form-input"
                                placeholder="Ej: Consulta paciente X" style="padding: 12px; border-radius: 8px;">
                        </div>
                        <button class="btn-theme" onclick="guardarIngreso()"
                            style="width: 100%; padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); border: none; margin-top: 10px;">
                            üíæ Guardar Ingreso
                        </button>
                    </div>

                    <!-- Form Gasto -->
                    <div id="form-container-gasto" class="card fin-form-card"
                        style="display: none; border-top: 5px solid #e74c3c; animation: fadeIn 0.3s ease;">
                        <h3 style="margin-bottom: 20px; color: #e74c3c; text-align: center;">Registrar Salida / Costo
                        </h3>
                        <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label style="font-weight: 500; color: #555;">Monto (RD$)</label>
                                <input type="number" id="fin-gasto-monto" class="form-input" placeholder="0.00" min="0"
                                    step="0.01" style="font-size: 1.2em; padding: 12px; border-radius: 8px;">
                            </div>
                            <div class="form-group">
                                <label style="font-weight: 500; color: #555;">Fecha</label>
                                <input type="date" id="fin-gasto-fecha" class="form-input"
                                    style="padding: 12px; border-radius: 8px;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label style="font-weight: 500; color: #555;">Categor√≠a</label>
                            <select id="fin-gasto-categoria" class="form-input"
                                style="padding: 12px; border-radius: 8px;">
                                <option value="">-- Seleccionar Categor√≠a --</option>
                                <option value="Renta">üè† Renta / Alquiler</option>
                                <option value="Salario Secretaria">üë©‚Äçüíº Salario Secretaria</option>
                                <option value="Salario Limpieza">üßπ Salario Limpieza</option>
                                <option value="Suministros M√©dicos">üíâ Suministros M√©dicos</option>
                                <option value="Impuestos">üèõÔ∏è Impuestos</option>
                                <option value="Mantenimiento">üîß Mantenimiento</option>
                                <option value="Servicios">üí° Servicios (Luz/Agua/Net)</option>
                                <option value="Otros">üì¶ Otros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="font-weight: 500; color: #555;">Nota Adicional</label>
                            <textarea id="fin-gasto-nota" class="form-input" rows="2"
                                placeholder="Detalles, factura #..."
                                style="padding: 12px; border-radius: 8px;"></textarea>
                        </div>
                        <button class="btn-theme" onclick="guardarGasto()"
                            style="width: 100%; padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%); border: none; margin-top: 10px;">
                            üíæ Guardar Gasto
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="card" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div class="form-group" style="margin: 0;">
                            <label style="font-size: 0.85em;">Filtrar por:</label>
                            <select id="fin-filtro-tipo" class="form-input" onchange="cargarFinanzas()">
                                <option value="todos">Todos</option>
                                <option value="ingreso">Solo Ingresos</option>
                                <option value="gasto">Solo Gastos</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label style="font-size: 0.85em;">Mes:</label>
                            <input type="month" id="fin-filtro-mes" class="form-input" onchange="cargarFinanzas()">
                        </div>
                        <button class="btn-secondary" onclick="limpiarFiltrosFinanzas()">üßπ Limpiar Filtros</button>
                    </div>
                </div>

                <!-- Tabla de Transacciones -->
                <div class="card" style="padding: 0;">
                    <div class="table-container" style="max-height: 50vh; overflow-y: auto;">
                        <table class="data-table" id="tabla-finanzas" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Concepto / Categor√≠a</th>
                                    <th>Nota</th>
                                    <th>Monto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="lista-finanzas">
                                <!-- JS Injected -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Resumen Mensual -->
                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        üìÖ Resumen Por Mes
                        <span style="font-size: 0.75em; font-weight: normal; color: #888;">(detectar meses en
                            negativo)</span>
                    </h3>
                    <!-- FINANCIAL DASHBOARD -->
                    <div id="fin-dashboard" class="fin-dashboard-grid" style="display: none;">
                        <!-- KPI Cards -->
                        <div class="kpi-card kpi-ingreso">
                            <div class="kpi-icon">üí∞</div>
                            <div class="kpi-info">
                                <h3>Ingresos Totales</h3>
                                <p id="kpi-total-ingreso">RD$ 0.00</p>
                            </div>
                        </div>

                        <div class="kpi-card kpi-gasto">
                            <div class="kpi-icon">üí∏</div>
                            <div class="kpi-info">
                                <h3>Gastos Totales</h3>
                                <p id="kpi-total-gasto">RD$ 0.00</p>
                            </div>
                        </div>

                        <div class="kpi-card kpi-balance">
                            <div class="kpi-icon">‚öñÔ∏è</div>
                            <div class="kpi-info">
                                <h3>Balance Neto</h3>
                                <p id="kpi-total-balance">RD$ 0.00</p>
                            </div>
                        </div>

                        <!-- Main Chart -->
                        <div class="chart-container-premium">
                            <canvas id="finanzaChart"></canvas>
                        </div>
                    </div>

                    <!-- Existing Table (Kept for detail view) -->
                    <h3 class="section-title" style="margin-top: 2rem;">üóìÔ∏è Detalle Mensual</h3>
                    <div class="table-responsive">
                        <table class="data-table" id="tabla-resumen-mensual">
                            <thead>
                                <tr>
                                    <th>Mes</th>
                                    <th>Ingresos</th>
                                    <th>Gastos</th>
                                    <th>Balance</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS renders rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
    </div>
    </section>
    </main>
    </div>

    <!-- Modal Cancelaci√≥n Obligatoria -->
    <div id="modal-cancelacion" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>üö´ Cancelar Cita</h3>
                <button class="modal-close" onclick="cerrarModalCancelacion()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-gray); margin-bottom: 15px;">
                    Para cancelar esta cita, es <strong>obligatorio</strong> seleccionar un motivo.
                </p>

                <div class="form-group">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Motivo de Cancelaci√≥n <span
                            style="color:red">*</span></label>
                    <select id="motivo-cancelacion" class="form-input" style="width: 100%;">
                        <option value="">-- Seleccione un motivo --</option>
                        <option value="Paciente no asiste (No Show)">Paciente no asiste (No Show)</option>
                        <option value="Paciente solicit√≥ cancelaci√≥n">Paciente solicit√≥ cancelaci√≥n</option>
                        <option value="Paciente reagend√≥">Paciente reagend√≥ fecha</option>
                        <option value="M√©dico no disponible">M√©dico no disponible / Emergencia</option>
                        <option value="Error de registro">Error de registro / Duplicado</option>
                        <option value="Falta de recursos/pago">Falta de recursos / Seguro rechazado</option>
                        <option value="Otro">Otro (Especificar abajo)</option>
                    </select>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Observaciones
                        Adicionales</label>
                    <textarea id="nota-cancelacion" class="form-input" rows="3"
                        placeholder="Detalles adicionales sobre la cancelaci√≥n..." style="width: 100%;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModalCancelacion()">Volver</button>
                <button class="btn-danger" onclick="confirmarCancelacionFinal()">üö® Confirmar Cancelaci√≥n</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content confirm-modal-content">
            <div class="modal-header">
                <h3 id="confirm-modal-title">Confirmar Acci√≥n</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-message">¬øEst√° seguro de realizar esta acci√≥n?</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-modal-cancel" class="btn-secondary">Cancelar</button>
                <button id="confirm-modal-ok" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Date Picker Modal -->
    <div id="datepicker-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content datepicker-modal-content">
            <div class="modal-header">
                <button id="dp-prev-month" class="dp-nav-btn">‚Äπ</button>
                <h3 id="dp-month-year"></h3>
                <button id="dp-next-month" class="dp-nav-btn">‚Ä∫</button>
            </div>
            <div class="dp-weekdays">
                <span>Dom</span><span>Lun</span><span>Mar</span><span>Mi√©</span><span>Jue</span><span>Vie</span><span>S√°b</span>
            </div>
            <div id="dp-days" class="dp-days"></div>
            <div class="modal-footer">
                <button id="dp-today" class="btn-secondary">Hoy</button>
                <button id="dp-cancel" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="note-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px">
            <div class="modal-header">
                <h3>üìù Notas de la Cita</h3>
                <button class="modal-close" onclick="cerrarModalNota()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 8px; color: var(--text-gray)">Agrega observaciones o detalles importantes:</p>
                <textarea id="note-input" class="form-input" rows="4" placeholder="Escribe aqu√≠..."></textarea>
                <input type="hidden" id="note-cita-id">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModalNota()">Cancelar</button>
                <button class="btn-primary" onclick="guardarNotaModal()">Guardar Nota</button>
            </div>
        </div>
    </div>


    <!-- Notifications Modal -->
    <div id="notifications-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 600px">
            <div class="modal-header">
                <h3>üîî √öltimas Citas Recibidas</h3>
                <button class="modal-close" onclick="cerrarModalNotificaciones()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: var(--text-gray); font-size: 0.9em;">
                    Listado cronol√≥gico de las √∫ltimas 20 citas agendadas ordenadas por fecha de creaci√≥n:
                </p>
                <div id="lista-notificaciones" class="modal-list notifications-list"
                    style="max-height: 400px; overflow-y: auto;">
                    <!-- Items JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Password Auth -->
    <div id="modal-password-auth" class="modal-overlay" style="display: none; z-index: 2100;">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header" style="justify-content: center;">
                <h3>üîí Autorizaci√≥n Requerida</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #555;">Acci√≥n protegida. Ingrese contrase√±a:</p>
                <div class="form-group">
                    <input type="password" id="auth-password" class="form-input" placeholder="Contrase√±a..."
                        style="text-align: center;">
                </div>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn-secondary" onclick="cerrarModalPassword()">Cancelar</button>
                <button class="btn-theme" onclick="verificarPasswordRestauracion()">Verificar</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>